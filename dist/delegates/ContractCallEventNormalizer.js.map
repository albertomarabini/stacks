{"version":3,"file":"ContractCallEventNormalizer.js","sourceRoot":"","sources":["../../src/delegates/ContractCallEventNormalizer.ts"],"names":[],"mappings":"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","sourcesContent":["// src/delegates/ContractCallEventNormalizer.ts\nimport type { IStacksChainClient } from '../contracts/interfaces';\nimport type { ISqliteStore } from '../contracts/dao';\nimport type { NormalizedEvent } from '../contracts/domain';\nimport { hexToCV, cvToJSON } from '@stacks/transactions';\n\nfunction cleanHex64(x?: string) {\n  return String(x ?? '').replace(/^0x/i, '').toLowerCase();\n}\nfunction toNumU(nLike: any) {\n  const s = String(nLike ?? '');\n  return Number(s.startsWith('u') ? s.slice(1) : s);\n}\nfunction isContractLog(ev: any) {\n  const t = ev?.event_type || ev?.eventType;\n  return t === 'smart_contract_log' || t === 'contract_log';\n}\n\n// Parse a contract_log `{ value: {hex, repr} }` into { tag, idHex, amountSats, ... }\nfunction parsePrint(ev: any) {\n  const v = ev?.contract_log?.value;\n  const repr: string = String(v?.repr ?? '');\n  const hex: string | undefined = v?.hex;\n\n  if (hex) {\n    try {\n      const cv = hexToCV(hex);\n      let j: any = cvToJSON(cv);\n      if (j?.type === 'response' && j.value) j = j.value;\n\n      // Normalize to the inner tuple\n      let tuple = j;\n      if (tuple?.type !== 'tuple' && tuple?.value?.type === 'tuple') tuple = tuple.value;\n\n      // Tuples from cvToJSON are arrays of { name, value, type }\n      const fields: any[] = Array.isArray(tuple?.value) ? tuple.value : [];\n      const get = (k: string) => fields.find((x: any) => x?.name === k)?.value;\n\n      // Tag/event\n      const tagVal = get('event') ?? get('tag');\n      const tag = String(tagVal?.value ?? tagVal ?? '').toLowerCase();\n\n      // ID (buff)\n      const idCV = get('id');\n      const idHex = cleanHex64(String(idCV?.value ?? idCV ?? ''));\n\n      // Amount (uint) — tolerate bigint or \"u…\" strings\n      const amtCV = get('amount');\n      const amountSats = toNumU(amtCV?.value ?? amtCV);\n\n      // Optionals we sometimes print with subscriptions\n      const merchantVal = get('merchant');\n      const merchant = String(merchantVal?.value ?? merchantVal ?? '') || undefined;\n\n      const subscriberVal = get('subscriber');\n      const subscriber = String(subscriberVal?.value ?? subscriberVal ?? '') || undefined;\n\n      const intervalVal = get('interval-blocks') ?? get('interval');\n      const intervalBlocks = toNumU(intervalVal?.value ?? intervalVal);\n\n      if (tag) {\n        return { tag, idHex, amountSats, merchant, subscriber, intervalBlocks };\n      }\n    } catch {\n      // fall through to repr parsing\n    }\n  }\n\n  // Fallback: look for “…invoice-refunded… 0x<64> … u<amt> …”\n  const m =\n    /(invoice-(?:paid|refunded|canceled))(?:(?!\\n).)*(0x[0-9a-fA-F]{64})?(?:(?!\\n).)*u(\\d+)/.exec(\n      repr\n    );\n  if (m) {\n    return {\n      tag: m[1].toLowerCase(),\n      idHex: cleanHex64(m[2] || ''),\n      amountSats: Number(m[3] || '0'),\n    };\n  }\n\n  const sm = /(subscription-(?:created|paid|canceled))/.exec(repr);\n  if (sm) return { tag: sm[1].toLowerCase() };\n\n  return null;\n}\n\n\nexport class ContractCallEventNormalizer {\n  async fetchAndFilterEvents(fromHeight: number, chain: IStacksChainClient, store: ISqliteStore) {\n    const events = await chain.getContractCallEvents({ fromHeight });\n    const out: NormalizedEvent[] = [];\n\n    for (const ev of events) {\n      if (!isContractLog(ev)) continue;\n\n      const block_height = Number(ev?.block_height ?? ev?.tx?.block_height ?? NaN);\n      if (!Number.isFinite(block_height)) continue;\n      const tx_id: string = String(ev?.tx_id ?? ev?.txid ?? '');\n      const tx_index: number = Number(ev?.tx_index ?? 0);\n\n      const p = parsePrint(ev);\n\n      // NEW: surface what we saw and why we skip\n      if (!p) {\n        console.debug('[EVT:NORM] skip (parse=null)', { tx_id, block_height, tx_index });\n        continue;\n      }\n      console.debug('[EVT:NORM] parsed', { tag: p.tag, idHex: p.idHex, amountSats: p.amountSats, tx_id });\n\n      if (p.tag === 'invoice-paid') {\n        const idHex = cleanHex64(p.idHex);\n        if (idHex && store.invoiceExists(idHex)) {\n          out.push({ type: 'invoice-paid', idHex, block_height, tx_id, tx_index });\n          console.debug('[EVT:NORM] -> push invoice-paid', { idHex, tx_id });\n        } else {\n          console.debug('[EVT:NORM] drop paid (missing/unknown idHex)', { idHex, tx_id });\n        }\n        continue;\n      }\n\n      if (p.tag === 'invoice-refunded') {\n        const idHex = cleanHex64(p.idHex);\n        if (idHex && store.invoiceExists(idHex)) {\n          const amt = Number(p.amountSats ?? 0);\n          out.push({ type: 'refund-invoice', idHex, amountSats: amt, block_height, tx_id, tx_index });\n          console.debug('[EVT:NORM] -> push refund-invoice', { idHex, amt, tx_id });\n        } else {\n          console.debug('[EVT:NORM] drop refund (missing/unknown idHex)', { idHex, tx_id });\n        }\n        continue;\n      }\n      if (!p || !p.tag) continue;\n\n      // Map prints → NormalizedEvent(s), always use **amountSats**\n      if (p.tag === 'invoice-paid') {\n        const idHex = cleanHex64(p.idHex);\n        if (idHex && store.invoiceExists(idHex)) {\n          out.push({ type: 'invoice-paid', idHex, block_height, tx_id, tx_index });\n        }\n        continue;\n      }\n\n      if (p.tag === 'invoice-refunded') {\n        const idHex = cleanHex64(p.idHex);\n        if (idHex && store.invoiceExists(idHex)) {\n          out.push({\n            type: 'refund-invoice',\n            idHex,\n            amountSats: Number(p.amountSats ?? 0),\n            block_height,\n            tx_id,\n            tx_index,\n          });\n        }\n        continue;\n      }\n\n      if (p.tag === 'invoice-canceled') {\n        const idHex = cleanHex64(p.idHex);\n        if (idHex && store.invoiceExists(idHex)) {\n          out.push({ type: 'invoice-canceled', idHex, block_height, tx_id, tx_index });\n        }\n        continue;\n      }\n\n      if (p.tag === 'subscription-created') {\n        const idHex = cleanHex64(p.idHex);\n        if (!idHex) continue;\n        out.push({\n          type: 'create-subscription',\n          idHex,\n          block_height,\n          tx_id,\n          tx_index,\n          merchantPrincipal: p.merchant,\n          subscriber: p.subscriber,\n          amountSats: Number(p.amountSats ?? 0),\n          intervalBlocks: Number(p.intervalBlocks ?? 0),\n        });\n        continue;\n      }\n\n      if (p.tag === 'subscription-paid') {\n        const idHex = cleanHex64(p.idHex);\n        if (!idHex) continue;\n        out.push({ type: 'pay-subscription', idHex, block_height, tx_id, tx_index });\n        continue;\n      }\n\n      if (p.tag === 'subscription-canceled') {\n        const idHex = cleanHex64(p.idHex);\n        if (!idHex) continue;\n        out.push({ type: 'cancel-subscription', idHex, block_height, tx_id, tx_index });\n        continue;\n      }\n    }\n\n    out.sort((a, b) => (a.block_height - b.block_height) || (a.tx_index - b.tx_index));\n    return out;\n  }\n}\n"]}