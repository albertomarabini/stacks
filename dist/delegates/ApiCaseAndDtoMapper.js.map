{"version":3,"file":"ApiCaseAndDtoMapper.js","sourceRoot":"","sources":["../../src/delegates/ApiCaseAndDtoMapper.ts"],"names":[],"mappings":";;;AAUA,MAAa,mBAAmB;IAC9B,kBAAkB,CAAC,CAAa;QAC9B,OAAO;YACL,SAAS,EAAE,CAAC,CAAC,MAAM;YACnB,KAAK,EAAE,CAAC,CAAC,MAAM;YACf,OAAO,EAAE,CAAC,CAAC,QAAQ;YACnB,UAAU,EAAE,CAAC,CAAC,WAAW;YACzB,WAAW,EAAE,CAAC,CAAC,aAAa;YAC5B,cAAc,EAAE,CAAC,CAAC,gBAAgB;YAClC,iBAAiB,EAAE,CAAC,CAAC,kBAAkB;YACvC,MAAM,EAAE,CAAC,CAAC,MAAM;YAChB,KAAK,EAAE,CAAC,CAAC,KAAK,IAAI,SAAS;YAC3B,IAAI,EAAE,CAAC,CAAC,IAAI,IAAI,SAAS;YACzB,IAAI,EAAE,CAAC,CAAC,IAAI,IAAI,SAAS;YACzB,cAAc,EAAE,CAAC,CAAC,eAAe,IAAI,SAAS;YAC9C,SAAS,EAAE,CAAC,CAAC,UAAU;YACvB,YAAY,EAAE,CAAC,CAAC,aAAa,IAAI,SAAS;YAC1C,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,SAAS;YACtC,KAAK,EAAE,SAAS;SACjB,CAAC;IACJ,CAAC;IAED,YAAY,CAAC,CAAgB;QAY3B,OAAO;YACL,EAAE,EAAE,CAAC,CAAC,EAAE;YACR,OAAO,EAAE,CAAC,CAAC,QAAQ;YACnB,SAAS,EAAE,CAAC,CAAC,UAAU,IAAI,IAAI;YAC/B,cAAc,EAAE,CAAC,CAAC,eAAe,IAAI,IAAI;YACzC,SAAS,EAAE,CAAC,CAAC,UAAU;YACvB,OAAO,EAAE,CAAC,CAAC,OAAO;YAClB,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,IAAI;YACjC,OAAO,EAAE,CAAC,CAAC,OAAO,KAAK,CAAC;YACxB,QAAQ,EAAE,CAAC,CAAC,QAAQ;YACpB,aAAa,EAAE,CAAC,CAAC,eAAe,IAAI,IAAI;SACzC,CAAC;IACJ,CAAC;IAGD,qBAAqB,CAAC,GAAgB;QACpC,OAAO;YACL,EAAE,EAAE,GAAG,CAAC,EAAE;YACV,IAAI,EAAE,GAAG,CAAC,IAAI,IAAI,SAAS;YAC3B,WAAW,EAAE,GAAG,CAAC,YAAY,IAAI,IAAI;YACrC,OAAO,EAAE,GAAG,CAAC,QAAQ,IAAI,IAAI;YAC7B,UAAU,EAAE,GAAG,CAAC,WAAW,IAAI,IAAI;YACnC,YAAY,EAAE,GAAG,CAAC,aAAa,IAAI,IAAI;YACvC,UAAU,EAAE,GAAG,CAAC,WAAW,IAAI,IAAI;YACnC,cAAc,EAAE,GAAG,CAAC,eAAe;gBACjC,CAAC,CAAC,GAAG,CAAC,eAAe;qBAChB,KAAK,CAAC,GAAG,CAAC;qBACV,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;qBACpB,MAAM,CAAC,OAAO,CAAC;gBACpB,CAAC,CAAC,EAAE;YACN,SAAS,EAAE,GAAG,CAAC,SAAS;YACxB,MAAM,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM;SACrB,CAAC;IACJ,CAAC;IAED,OAAO,CAAU,KAAU;QACzB,IAAI,KAAK,KAAK,IAAI,IAAI,OAAO,KAAK,KAAK,QAAQ;YAAE,OAAO,KAAU,CAAC;QACnE,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC;YAAE,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAQ,CAAC;QAC1E,MAAM,GAAG,GAAwB,EAAE,CAAC;QACpC,KAAK,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC;YAC3C,MAAM,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,EAAE,CAAS,EAAE,EAAE,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC;YACxE,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QAC/B,CAAC;QACD,OAAO,GAAQ,CAAC;IAClB,CAAC;IAED,OAAO,CAAsD,KAAU;QACrE,IAAI,KAAK,KAAK,IAAI,IAAI,OAAO,KAAK,KAAK,QAAQ;YAAE,OAAO,KAAU,CAAC;QACnE,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC;YAAE,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAQ,CAAC;QAC1E,MAAM,GAAG,GAAwB,EAAE,CAAC;QACpC,KAAK,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC;YAC3C,MAAM,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;YAChE,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QAC/B,CAAC;QACD,OAAO,GAAQ,CAAC;IAClB,CAAC;CACF;AA1FD,kDA0FC","sourcesContent":["// src/delegates/ApiCaseAndDtoMapper.ts\nimport type {\n  InvoiceRow,\n  WebhookLogRow,\n  MerchantRow,\n  PublicInvoiceDTO,\n  StorePrivateProfileDTO,\n} from '../contracts/domain';\n\n\nexport class ApiCaseAndDtoMapper {\n  invoiceToPublicDto(r: InvoiceRow): PublicInvoiceDTO {\n    return {\n      invoiceId: r.id_raw,\n      idHex: r.id_hex,\n      storeId: r.store_id,\n      amountSats: r.amount_sats,\n      usdAtCreate: r.usd_at_create,\n      quoteExpiresAt: r.quote_expires_at,\n      merchantPrincipal: r.merchant_principal,\n      status: r.status,\n      payer: r.payer ?? undefined,\n      txId: r.txid ?? undefined,\n      memo: r.memo ?? undefined,\n      subscriptionId: r.subscription_id ?? undefined,\n      createdAt: r.created_at,\n      refundAmount: r.refund_amount ?? undefined,\n      refundTxId: r.refund_txid ?? undefined,\n      store: undefined,\n    };\n  }\n\n  webhookToDto(w: WebhookLogRow): {\n    id: string;\n    storeId: string;\n    invoiceId?: string | null;\n    subscriptionId?: string | null;\n    eventType: string;\n    payload: string;\n    statusCode: number | null;\n    success: boolean;\n    attempts: number;\n    lastAttemptAt: number | null;\n  } {\n    return {\n      id: w.id,\n      storeId: w.store_id,\n      invoiceId: w.invoice_id ?? null,\n      subscriptionId: w.subscription_id ?? null,\n      eventType: w.event_type,\n      payload: w.payload,\n      statusCode: w.status_code ?? null,\n      success: w.success === 1,\n      attempts: w.attempts,\n      lastAttemptAt: w.last_attempt_at ?? null,\n    };\n  }\n\n\n  storeToPrivateProfile(row: MerchantRow): StorePrivateProfileDTO {\n    return {\n      id: row.id,\n      name: row.name ?? undefined,\n      displayName: row.display_name ?? null,\n      logoUrl: row.logo_url ?? null,\n      brandColor: row.brand_color ?? null,\n      supportEmail: row.support_email ?? null,\n      supportUrl: row.support_url ?? null,\n      allowedOrigins: row.allowed_origins\n        ? row.allowed_origins\n            .split(',')\n            .map((s) => s.trim())\n            .filter(Boolean)\n        : [],\n      principal: row.principal,\n      active: !!row.active,\n    };\n  }\n\n  toCamel<T = any>(input: any): T {\n    if (input === null || typeof input !== 'object') return input as T;\n    if (Array.isArray(input)) return input.map((v) => this.toCamel(v)) as any;\n    const out: Record<string, any> = {};\n    for (const [k, v] of Object.entries(input)) {\n      const camel = k.replace(/_([a-z])/g, (_, c: string) => c.toUpperCase());\n      out[camel] = this.toCamel(v);\n    }\n    return out as T;\n  }\n\n  toSnake<T extends Record<string, any> = Record<string, any>>(input: any): T {\n    if (input === null || typeof input !== 'object') return input as T;\n    if (Array.isArray(input)) return input.map((v) => this.toSnake(v)) as any;\n    const out: Record<string, any> = {};\n    for (const [k, v] of Object.entries(input)) {\n      const snake = k.replace(/[A-Z]/g, (c) => `_${c.toLowerCase()}`);\n      out[snake] = this.toSnake(v);\n    }\n    return out as T;\n  }\n}\n"]}