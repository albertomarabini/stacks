{"version":3,"file":"AdminDtoProjector.js","sourceRoot":"","sources":["../../src/delegates/AdminDtoProjector.ts"],"names":[],"mappings":";;;AAuDA,MAAa,iBAAiB;IAC5B,aAAa,CAAC,CAAwB;QACpC,OAAO;YACL,EAAE,EAAE,CAAC,CAAC,EAAE;YACR,SAAS,EAAE,CAAC,CAAC,SAAS;YACtB,IAAI,EAAE,CAAC,CAAC,IAAI,IAAI,SAAS;YACzB,WAAW,EAAE,CAAC,CAAC,YAAY,IAAI,SAAS;YACxC,OAAO,EAAE,CAAC,CAAC,QAAQ,IAAI,SAAS;YAChC,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,SAAS;YACtC,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,SAAS;YACtC,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM;YAClB,YAAY,EAAE,CAAC,CAAC,aAAa,IAAI,SAAS;YAC1C,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,SAAS;YACtC,cAAc,EAAE,CAAC,CAAC,eAAe,IAAI,SAAS;YAC9C,SAAS,EAAE,CAAC,CAAC,UAAU;SACxB,CAAC;IACJ,CAAC;IAED,YAAY,CAAC,CAAa;QACxB,OAAO;YACL,KAAK,EAAE,CAAC,CAAC,MAAM;YACf,KAAK,EAAE,CAAC,CAAC,MAAM;YACf,OAAO,EAAE,CAAC,CAAC,QAAQ;YACnB,UAAU,EAAE,CAAC,CAAC,WAAW;YACzB,WAAW,EAAE,CAAC,CAAC,aAAa;YAC5B,cAAc,EAAE,CAAC,CAAC,gBAAgB;YAClC,iBAAiB,EAAE,CAAC,CAAC,kBAAkB;YACvC,MAAM,EAAE,CAAC,CAAC,MAAM;YAChB,KAAK,EAAE,CAAC,CAAC,KAAK,IAAI,SAAS;YAC3B,IAAI,EAAE,CAAC,CAAC,IAAI,IAAI,SAAS;YACzB,IAAI,EAAE,CAAC,CAAC,IAAI,IAAI,SAAS;YACzB,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,SAAS;YACtC,SAAS,EAAE,CAAC,CAAC,UAAU;YACvB,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,SAAS;YACtC,YAAY,EAAE,CAAC,CAAC,aAAa;YAC7B,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,SAAS;YACtC,cAAc,EAAE,CAAC,CAAC,eAAe,IAAI,SAAS;YAC9C,WAAW,EAAE,CAAC,CAAC,YAAY;YAC3B,OAAO,EAAE,CAAC,CAAC,OAAO;SACnB,CAAC;IACJ,CAAC;IAED,YAAY,CAAC,CAAgB;QAC3B,OAAO;YACL,EAAE,EAAE,CAAC,CAAC,EAAE;YACR,OAAO,EAAE,CAAC,CAAC,QAAQ;YACnB,SAAS,EAAE,CAAC,CAAC,UAAU,IAAI,SAAS;YACpC,cAAc,EAAE,CAAC,CAAC,eAAe,IAAI,SAAS;YAC9C,SAAS,EAAE,CAAC,CAAC,UAAU;YACvB,OAAO,EAAE,CAAC,CAAC,OAAO;YAClB,UAAU,EAAE,CAAC,CAAC,WAAW,IAAI,SAAS;YACtC,OAAO,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO;YACpB,QAAQ,EAAE,CAAC,CAAC,QAAQ;YACpB,aAAa,EAAE,CAAC,CAAC,eAAe;SACjC,CAAC;IACJ,CAAC;CACF;AAxDD,8CAwDC","sourcesContent":["// src/delegates/AdminDtoProjector.ts\nimport type { MerchantRow, InvoiceRow, WebhookLogRow } from '../contracts/domain';\n\nexport type MerchantProjectionRow = Omit<MerchantRow, 'api_key' | 'hmac_secret'>;\n\nexport type MerchantDto = {\n  id: string;\n  principal: string;\n  name?: string;\n  displayName?: string;\n  logoUrl?: string;\n  brandColor?: string;\n  webhookUrl?: string;\n  active: boolean;\n  supportEmail?: string;\n  supportUrl?: string;\n  allowedOrigins?: string;\n  createdAt: number;\n};\n\nexport type AdminInvoiceDto = {\n  idRaw: string;\n  idHex: string;\n  storeId: string;\n  amountSats: number;\n  usdAtCreate: number;\n  quoteExpiresAt: number;\n  merchantPrincipal: string;\n  status: string;\n  payer?: string;\n  txId?: string;\n  memo?: string;\n  webhookUrl?: string;\n  createdAt: number;\n  refundedAt?: number;\n  refundAmount: number;\n  refundTxId?: string;\n  subscriptionId?: string;\n  refundCount: number;\n  expired: number;\n};\n\nexport type AdminWebhookDto = {\n  id: string;\n  storeId: string;\n  invoiceId?: string;\n  subscriptionId?: string;\n  eventType: string;\n  payload: string;\n  statusCode?: number;\n  success: boolean;\n  attempts: number;\n  lastAttemptAt: number;\n};\n\nexport class AdminDtoProjector {\n  merchantToDto(r: MerchantProjectionRow): MerchantDto {\n    return {\n      id: r.id,\n      principal: r.principal,\n      name: r.name ?? undefined,\n      displayName: r.display_name ?? undefined,\n      logoUrl: r.logo_url ?? undefined,\n      brandColor: r.brand_color ?? undefined,\n      webhookUrl: r.webhook_url ?? undefined,\n      active: !!r.active,\n      supportEmail: r.support_email ?? undefined,\n      supportUrl: r.support_url ?? undefined,\n      allowedOrigins: r.allowed_origins ?? undefined,\n      createdAt: r.created_at,\n    };\n  }\n\n  invoiceToDto(r: InvoiceRow): AdminInvoiceDto {\n    return {\n      idRaw: r.id_raw,\n      idHex: r.id_hex,\n      storeId: r.store_id,\n      amountSats: r.amount_sats,\n      usdAtCreate: r.usd_at_create,\n      quoteExpiresAt: r.quote_expires_at,\n      merchantPrincipal: r.merchant_principal,\n      status: r.status,\n      payer: r.payer ?? undefined,\n      txId: r.txid ?? undefined,\n      memo: r.memo ?? undefined,\n      webhookUrl: r.webhook_url ?? undefined,\n      createdAt: r.created_at,\n      refundedAt: r.refunded_at ?? undefined,\n      refundAmount: r.refund_amount,\n      refundTxId: r.refund_txid ?? undefined,\n      subscriptionId: r.subscription_id ?? undefined,\n      refundCount: r.refund_count,\n      expired: r.expired,\n    };\n  }\n\n  webhookToDto(w: WebhookLogRow): AdminWebhookDto {\n    return {\n      id: w.id,\n      storeId: w.store_id,\n      invoiceId: w.invoice_id ?? undefined,\n      subscriptionId: w.subscription_id ?? undefined,\n      eventType: w.event_type,\n      payload: w.payload,\n      statusCode: w.status_code ?? undefined,\n      success: !!w.success,\n      attempts: w.attempts,\n      lastAttemptAt: w.last_attempt_at,\n    };\n  }\n}\n"]}