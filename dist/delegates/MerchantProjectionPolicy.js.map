{"version":3,"file":"MerchantProjectionPolicy.js","sourceRoot":"","sources":["../../src/delegates/MerchantProjectionPolicy.ts"],"names":[],"mappings":";;;AAGA,MAAa,wBAAwB;IACnC,oBAAoB;QAClB,OAAO;;;;;;;;;;;;;;;;KAgBN,CAAC;IACJ,CAAC;IAED,UAAU,CAAC,GAAQ;QACjB,OAAO;YACL,EAAE,EAAE,GAAG,CAAC,EAAY;YACpB,SAAS,EAAE,GAAG,CAAC,SAAmB;YAClC,IAAI,EAAE,GAAG,CAAC,IAAI,IAAI,SAAS;YAC3B,YAAY,EAAE,GAAG,CAAC,YAAY,IAAI,SAAS;YAC3C,QAAQ,EAAE,GAAG,CAAC,QAAQ,IAAI,SAAS;YACnC,WAAW,EAAE,GAAG,CAAC,WAAW,IAAI,SAAS;YACzC,WAAW,EAAE,GAAG,CAAC,WAAW,IAAI,SAAS;YACzC,MAAM,EAAE,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC;YAC1B,aAAa,EAAE,GAAG,CAAC,aAAa,IAAI,SAAS;YAC7C,WAAW,EAAE,GAAG,CAAC,WAAW,IAAI,SAAS;YACzC,eAAe,EAAE,GAAG,CAAC,eAAe,IAAI,SAAS;YACjD,UAAU,EAAE,MAAM,CAAC,GAAG,CAAC,UAAU,CAAC;YAElC,4BAA4B;YAC5B,qBAAqB,EAAE,MAAM,CAAC,GAAG,CAAC,qBAAqB,IAAI,CAAC,CAAC;YAC7D,oBAAoB,EAClB,GAAG,CAAC,oBAAoB,IAAI,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,SAAS;YACjF,qBAAqB,EACnB,GAAG,CAAC,qBAAqB,IAAI,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,SAAS;YACnF,qBAAqB,EACnB,GAAG,CAAC,qBAAqB,IAAI,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,SAAS;SACpF,CAAC;IACJ,CAAC;CACF;AA9CD,4DA8CC","sourcesContent":["// src/delegates/MerchantProjectionPolicy.ts\nimport type { MerchantRow } from '../contracts/domain';\n\nexport class MerchantProjectionPolicy {\n  getListProjectionSQL(): string {\n    return `\n      SELECT\n        id,\n        principal,\n        name,\n        display_name,\n        logo_url,\n        brand_color,\n        webhook_url,\n        active,\n        support_email,\n        support_url,\n        allowed_origins,\n        created_at\n      FROM merchants\n      ORDER BY created_at DESC\n    `;\n  }\n\n  mapListRow(raw: any): Omit<MerchantRow, 'api_key' | 'hmac_secret'> {\n    return {\n      id: raw.id as string,\n      principal: raw.principal as string,\n      name: raw.name ?? undefined,\n      display_name: raw.display_name ?? undefined,\n      logo_url: raw.logo_url ?? undefined,\n      brand_color: raw.brand_color ?? undefined,\n      webhook_url: raw.webhook_url ?? undefined,\n      active: Number(raw.active),\n      support_email: raw.support_email ?? undefined,\n      support_url: raw.support_url ?? undefined,\n      allowed_origins: raw.allowed_origins ?? undefined,\n      created_at: Number(raw.created_at),\n\n      // NEW: key-rotation columns\n      keys_rotation_version: Number(raw.keys_rotation_version ?? 0),\n      keys_last_rotated_at:\n        raw.keys_last_rotated_at != null ? Number(raw.keys_last_rotated_at) : undefined,\n      keys_last_revealed_at:\n        raw.keys_last_revealed_at != null ? Number(raw.keys_last_revealed_at) : undefined,\n      keys_dual_valid_until:\n        raw.keys_dual_valid_until != null ? Number(raw.keys_dual_valid_until) : undefined,\n    };\n  }\n}\n"]}